.PHONY: help install run clean remove_old

# === Configuration ===
MT4_URL := https://download.mql5.com/cdn/web/metaquotes.software/mt4/mt4setup.exe
MT4_INSTALLER := mt4setup.exe
CONFIG_DIR := ~/Configs/manjaro/Makefile

# === Help ===
help:
	@echo "üìå Available targets:"
	@echo "  make install     ‚Äì –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PlayOnLinux –∏ —Å–∫–∞—á–∞—Ç—å —Å–≤–µ–∂–∏–π MetaTrader 4"
	@echo "  make run         ‚Äì –ó–∞–ø—É—Å—Ç–∏—Ç—å MT4 —á–µ—Ä–µ–∑ PlayOnLinux"
	@echo "  make clean       ‚Äì –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ MT4"
	@echo "  make remove_old  ‚Äì –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ Wine-–ø—Ä–µ—Ñ–∏–∫—Å—ã –∏ –∫–∞—Ç–∞–ª–æ–≥–∏"

# === Install PlayOnLinux and download MT4 ===
install:
	@echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑ $(CONFIG_DIR)..."
	$(MAKE) -f $(CONFIG_DIR) update

	@echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PlayOnLinux —á–µ—Ä–µ–∑ yay..."
	yay -S --noconfirm playonlinux wget

	@echo "‚¨áÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞ MetaTrader 4..."
	wget -O $(MT4_INSTALLER) $(MT4_URL)

	@echo "üìÇ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MetaTrader 4 –≤—Ä—É—á–Ω—É—é:"
	@echo "1. –û—Ç–∫—Ä–æ–π PlayOnLinux."
	@echo "2. –ù–∞–∂–º–∏ '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å', –≤—ã–±–µ—Ä–∏ '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –Ω–µ –∏–∑ —Å–ø–∏—Å–∫–∞'."
	@echo "3. –£–∫–∞–∂–∏ –ø—É—Ç—å –∫ $(MT4_INSTALLER)."
	@echo "4. –£—Å—Ç–∞–Ω–æ–≤–∏ –≤ 32-–±–∏—Ç–Ω–æ–º –ø—Ä–µ—Ñ–∏–∫—Å–µ, –≤—ã–±—Ä–∞–≤ Windows 10."
	@echo "‚úÖ –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 'make run' –¥–ª—è –∑–∞–ø—É—Å–∫–∞ MT4."

# === Run MT4 through PlayOnLinux ===
run:
	@echo "üöÄ –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å MT4 —á–µ—Ä–µ–∑ PlayOnLinux..."
	playonlinux --run "MetaTrader 4" || echo "‚ùå –£–±–µ–¥–∏—Å—å, —á—Ç–æ MetaTrader 4 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ PlayOnLinux."

# === Cleanup ===
clean:
	@echo "üßπ –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞ MT4..."
	rm -f $(MT4_INSTALLER)

# === Remove old Wine setups ===
remove_old:
	@echo "‚ùå –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö Wine-–ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –∏ —É—Å—Ç–∞–Ω–æ–≤–æ–∫ MT4..."
	rm -rf ~/.wine_mt4 ~/.mt4 ~/.PlayOnLinux
	rm -f ~/mt4setup.exe ~/MT4/setup.exe
