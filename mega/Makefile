.PHONY: help h sync s

help h:
	@echo "ğŸ“˜ Available targets:"
	@echo "---------------------------------------------------------------------"
	@echo "  make sync / s <LOCAL> <REMOTE>  - ğŸ” Sync local folder with MEGA remote"
	@echo "  make help / h                   - ğŸ“– Show this help"
	@echo "---------------------------------------------------------------------"

sync s:
	@if [ $(words $(MAKECMDGOALS)) -ne 3 ]; then \
		echo "âŒ Usage: make sync <LOCAL_PATH> <REMOTE_PATH>"; \
		echo "Example: make sync /home/user/deploy /MyProjectDeploys/MyApp"; \
		exit 1; \
	fi; \
	LOCAL_PATH="$(word 2,$(MAKECMDGOALS))"; \
	REMOTE_PATH="$(word 3,$(MAKECMDGOALS))"; \
	\
	echo "ğŸ“ Local path: $$LOCAL_PATH"; \
	echo "ğŸŒ Remote path: $$REMOTE_PATH"; \
	echo "---------------------------------------------------------------------"; \
	\
	echo "ğŸ” Verifying local pathâ€¦"; \
	if [ ! -d "$$LOCAL_PATH" ]; then \
		echo "âŒ Local path not found: $$LOCAL_PATH"; \
		exit 1; \
	fi; \
	echo "âœ… Local path exists: $$LOCAL_PATH"; \
	echo "---------------------------------------------------------------------"; \
	\
	echo "ğŸ”„ Verifying Mega login..."; \
	mega-whoami >/dev/null 2>&1 || { echo "ğŸš« Not logged in. Run: mega-login"; exit 1; }; \
	echo "---------------------------------------------------------------------"; \
	\
	echo "ğŸ” Checking remote folder..."; \
	mega-ls "$$REMOTE_PATH" >/dev/null 2>&1 || { \
		echo "ğŸ“ Remote folder not found. Creating..."; \
		mega-mkdir -p "$$REMOTE_PATH" || { echo "âŒ Failed to create remote folder"; exit 1; }; \
	}; \
	echo "âœ… Remote folder ready."; \
	echo "---------------------------------------------------------------------"; \
	\
	echo "ğŸ“ Local path: $$LOCAL_PATH"; \
	echo "ğŸŒ Remote path: $$REMOTE_PATH"; \
	echo "---------------------------------------------------------------------"; \
	\
	echo "ğŸ” Starting sync..."; \
	mega-sync "$$LOCAL_PATH" "$$REMOTE_PATH" || { echo "âŒ mega-sync failed"; exit 1; }; \
	echo "---------------------------------------------------------------------"; \
	\
	echo "ğŸ“‹ Verifying sync is active..."; \
	mega-sync | grep -F "$$LOCAL_PATH" | grep -F "$$REMOTE_PATH" >/dev/null && \
		echo "âœ… Sync established." || { echo "âš ï¸  Sync not listed. Please verify manually."; exit 1; }

%:
	@:
