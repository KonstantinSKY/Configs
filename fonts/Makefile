.PHONY: all install_fonts update_fonts check_fonts refresh_fonts help

FONTS = \
	noto-fonts \
	noto-fonts-emoji \
	ttf-jetbrains-mono \
	ttf-hack \
	ttf-hack-nerd

all: install_fonts update_fonts refresh_fonts check_fonts

help:
	@echo "üìñ Available targets:"
	@echo "  make install_fonts   ‚Äì Install all fonts via yay"
	@echo "  make update_fonts    ‚Äì Update system packages"
	@echo "  make refresh_fonts   ‚Äì Rebuild font cache (fc-cache)"
	@echo "  make check_fonts     ‚Äì Check if fonts are installed"
	@echo "  make all             ‚Äì Run install, update, refresh, and check"
	@echo "  make help            ‚Äì Show this help message"

install_fonts:
	@echo "üî§ Installing fonts with yay..."
	@for font in $(FONTS); do \
		echo "üì¶ Installing $$font..."; \
		yay -S --noconfirm $$font || echo "‚ö†Ô∏è  Failed to install $$font"; \
	done

update_fonts:
	@echo "üîÅ Updating all packages with yay..."
	yay -Syu --noconfirm

refresh_fonts:
	@echo "üîÑ Refreshing font cache..."
	fc-cache -fv
	@echo "‚úÖ Font cache refreshed."

check_fonts:
	@echo "üîç Checking if fonts are installed and showing examples..."
	@for font in $(FONTS); do \
		if yay -Q $$font >/dev/null 2>&1; then \
			echo "‚úÖ $$font is installed."; \
			MATCHED=$$(fc-match ":family=$${font}" | cut -d: -f1); \
			if [ -n "$$MATCHED" ]; then \
				echo "üìù Sample (using $$MATCHED):"; \
				echo "    ‚Üí The quick brown fox jumps over the lazy dog." | \
				PANGOCAIRO_BACKEND=fc \
				PANGO_FONT="$${MATCHED}" \
				pango-view --text="The quick brown fox jumps over the lazy dog." \
					--font="$${MATCHED} 12" \
					--no-display --annotate=none --dpi=96 --output=/dev/null \
				|| echo "‚ö†Ô∏è  Can't render preview for $$MATCHED."; \
			fi \
		else \
			echo "‚ùå $$font is NOT installed."; \
		fi; \
	done
