.PHONY: all install update check refresh help

FONTS = \
	noto-fonts \
	noto-fonts-emoji \
	ttf-jetbrains-mono \
	ttf-jetbrains-mono-nerd \
	ttf-hack \
	ttf-hack-nerd \
	ttf-ubuntu-font-family \
	ttf-ubuntu-mono-nerd \
	ttf-ubuntu-nerd \
	ttf-fira-code \
	ttf-firacode-nerd \
	ttf-sourcecodepro-nerd \
	ttf-sourcecodepro-nerd


all: install update refresh check

help:
	@echo "üìñ Available targets:"
	@echo "  make install   ‚Äì Install all fonts via yay"
	@echo "  make update    ‚Äì Update system packages"
	@echo "  make refresh   ‚Äì Rebuild font cache (fc-cache)"
	@echo "  make check     ‚Äì Check if fonts are installed"
	@echo "  make all       ‚Äì Run install, update, refresh, and check"
	@echo "  make help      ‚Äì Show this help message"

install:
	@echo "üî§ Installing fonts with yay..."
	@for font in $(FONTS); do \
		echo "üì¶ Installing $$font..."; \
		yay -S --noconfirm $$font || echo "‚ö†Ô∏è  Failed to install $$font"; \
	done

update:
	@echo "üîÅ Updating all packages with yay..."
	yay -Syu --noconfirm

refresh:
	@echo "üîÑ Refreshing font cache..."
	fc-cache -fv
	@echo "‚úÖ Font cache refreshed."

check:
	@echo "üîç Checking if fonts are installed and showing examples..."
	@if ! command -v pango-view >/dev/null 2>&1; then \
		echo "‚ö†Ô∏è  pango-view is not installed. Previews won't be shown."; \
	fi
	@for font in $(FONTS); do \
		if yay -Q $$font >/dev/null 2>&1; then \
			echo "‚úÖ $$font is installed."; \
		else \
			echo "‚ùå $$font is NOT installed."; \
		fi; \
	done
	@echo "-------------------------------------------------------------------"
	@echo "üß™ Testing font cache (fc-list)..."
		@if ! fc-list > /dev/null 2>&1; then \
			echo "‚ùå Font cache seems broken or inaccessible."; \
		else \
			echo "‚úÖ Font cache is readable."; \
		fi

list:
	@echo "üìã Fonts listed in Makefile:"
	@for font in $(FONTS); do echo " ‚Ä¢ $$font"; done
	@echo "-------------------------------------------------------------------"
	@echo "üì¶ Fonts from yay (installed from your list):"
	@for font in $(FONTS); do \
		if yay -Q $$font >/dev/null 2>&1; then \
			echo " ‚úÖ $$font"; \
		else \
			echo " ‚ùå $$font not installed"; \
		fi \
	done
	@echo "-------------------------------------------------------------------"
	@echo "üñã  Fonts available via fontconfig (fc-list):"
	@fc-list : family | cut -d',' -f1 | sort | uniq | head -n 2000
