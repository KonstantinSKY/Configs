MANJARO_MAKEFILE := $(HOME)/Configs/manjaro/Makefile

.PHONY: help install isetup s

help:
	@echo "ğŸ›   Available targets:"
	@echo "  make install / i     Install Docker and its ecosystem"
	@echo "  make setup  / s      Enable and start Docker, add user to group"
	@echo "------------------------------------------------------------"

install i:
	@echo "ğŸ³ Installing Docker ecosystem using universal Manjaro Makefile..."
	@make -f $(MANJARO_MAKEFILE) install docker docker-compose

	@echo "ğŸ” Checking installed Docker versions after install:"
	@docker --version || echo "âŒ Docker not found"
	@docker compose version || echo "âŒ docker compose not found"
	@docker buildx version || echo "âŒ docker buildx not found"
	@echo "------------------------------------------------------------"

	@$(MAKE) setup

setup s:
	@echo "ğŸ”§ Enabling and starting Docker daemon..."
	@sudo systemctl enable docker
	@sudo systemctl start docker

	@echo "ğŸ‘¤ Adding user '$(USER)' to 'docker' group..."
	@sudo usermod -aG docker $(USER)

	@echo "------------------------------------------------------------"
	@echo "ğŸ” Final Docker version check:"
	@docker --version || echo "âŒ Docker not found"
	@docker compose version || echo "âŒ docker compose not found"
	@docker buildx version || echo "âŒ docker buildx not found"
	@echo "------------------------------------------------------------"

	@echo "âš ï¸  Please reboot or run 'newgrp docker' to apply group changes."
	@echo "âœ… Docker setup complete."
